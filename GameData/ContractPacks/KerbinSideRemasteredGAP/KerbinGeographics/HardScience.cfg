// -----------------------------------------------------------------
//	CONTRACT:  KSRGAP-KGO-Research Hard Science - Kerbin Geographics Organization - Kerbin Geographics Organization
//	Author: Caerfinon 
// Contract for doing difficult situation/biome combinations.
//	Credits:
//	{
//		FieldScience: Author - nightingale 
//	}
// -----------------------------------------------------------------

CONTRACT_TYPE
{
	sortKey = KSRGAP-KGO04
	name =  KSRGAP-KGO-Research Hard Science
	title = Gather rare science results from @biome.FullName()
    genericTitle = Gather rare science results
    genericDescription = Run experiments while landed on the ocean, or on the water in a desert.  THe right locations are out there!
	group = Kerbin Geographics Organization
	agent = Kerbin Geographics Organization
    description = @isLanded ? @landStr : @waterStr
    synopsis = Run the requested experiments while @situation.ToString().ToLower() at @biome.FullName().
    completedMessage = This is some great data that we've accumulated!

//Contract Limits
	maxCompletions = 0
	maxSimultaneous = 1
	autoAccept = false
	declinable = true
	cancellable = true
	minExpiry = 1.0
	maxExpiry = 1.0
	deadline = 0

//Contract Reward Modifiers
	prestige = Significant
	targetBody = Kerbin
	
//Contract Rewards
	rewardFunds = @KSRGAP:rewardBaseValue * 4 * Random(1.0,1.15)
	advanceFunds = (@/rewardFunds * 0.25 )
	rewardReputation = 1
    rewardScience = 0

//Contract Penalties
	failureFunds =  (@/rewardFunds * 1.15) * Random(1.0, 1.25)  
	failureReputation = 10

// -----------------------------------------------------------------	
// REQUIREMENTS FOR CONTRACT TO APPEAR
// -----------------------------------------------------------------	
//
// Comment about requirement
//	REQUIREMENT
//	{
//		name = 
//		type = 
//	} 


// -----------------------------------------------------------------	
//DATA NODES TO PROCESS FOR CONTRACT USE
// -----------------------------------------------------------------

    DATA
    {
        type = string
        hidden = true

        water = @isNotWater ? "whatever passes for water on @targetBody" : "water"
        waterStr = They say that it's difficult to find @water at @biome.FullName().  We've mapped out a few locations where there might be some.  Find a suitable spot and run some experiments.
        landStr = They say there isn't much land at @biome.FullName().  We've mapped out a few locations where there might be some.  Find a suitable spot and run some experiments.

        sitStr = @isLanded ? "Landing" : "Splashdown"
    }

    DATA
    {
        type = Biome
        hidden = true

        biome = @ss0.Biome()
    }

    DATA
    {
        type = ExperimentSituations
        hidden = true

        situation = @ss0.Situation()
    }

    DATA
    {
        type = bool
        isLanded = @situation == SrfLanded
    }

    DATA:NEEDS[!RealSolarSystem,!GPP]
    {
        type = bool

        isNotWater = @targetBody == Eve
    }

    DATA:NEEDS[RealSolarSystem]
    {
        type = bool

        isNotWater = @targetBody == Titan
    }
	
	DATA:NEEDS[GPP]
    {
        type = bool

        isNotWater = @targetBody == Tarsiss || @targetBody == Hadrian
    }

    DATA
    {
        type = List<CelestialBody>
        hidden = true

        validBodies = [ HomeWorld()]
    }

    DATA
    {
        type = List<ScienceSubject>
        hidden = true

        ssTemp1 = DifficultScienceSubjectsByBody(@validBodies)
        ssTemp2 = @ssTemp1.Where(s => s.RemainingScience() > 0.0 && s.Experiment() != ROCScience_KerbinBaobabTree && s.Experiment() != ROCScience_GiantQuartz)
    }

    DATA
    {
        type = ScienceSubject
        hidden = true

        ss0 = @ssTemp2.Random()
    }

    DATA
    {
        type = List<ScienceSubject>
        title = Must have a valid experiment to run in a rare situation

        scienceSubjectsTemp1 = DifficultScienceSubjects().Where(s => s.Biome() == @biome)
        scienceSubjectsTemp2 = @scienceSubjectsTemp1.Where(s => s.Situation() == @situation)
        scienceSubjects = @scienceSubjectsTemp2.Where(s => s.CollectedScience() == 0.0 && s.Experiment() != asteroidSample)
    }

    DATA
    {
        type = List<Location>
        hidden = true

        locations = @biome.DifficultLocations()
    }

    DATA
    {
        type = Location
        requiredValue = false

        loc0 = @locations.ElementAt(0)
        loc1 = @locations.ElementAt(1)
        loc2 = @locations.ElementAt(2)
    }

    DATA
    {
        type = ScienceRecoveryMethod
        recoveryMethod = @targetBody.IsHomeWorld() || @targetBody.Parent().IsHomeWorld() ? Ideal : RecoverOrTransmit
    }

// -----------------------------------------------------------------
//BEHAVIOURS TO DO WHEN CREATING CONTRACT
// -----------------------------------------------------------------

    BEHAVIOUR
    {
        name = WaypointGenerator
        type = WaypointGenerator

        WAYPOINT
        {
            name = "Suggested @/biome.Name() @/sitStr"
            icon = ContractPacks/FieldResearch/Icons/research

            latitude = @/loc0.Latitude()
            longitude = @/loc0.Longitude()
            altitude = 0.0
        }

        WAYPOINT
        {
            name = "Suggested @/biome.Name() @/sitStr"
            icon = ContractPacks/FieldResearch/Icons/research

            hidden = @/locations.Count() < 2

            latitude = @/loc1.Latitude()
            longitude = @/loc1.Longitude()
            altitude = 0.0
        }

        WAYPOINT
        {
            name = "Suggested @/biome.Name() @/sitStr"
            icon = ContractPacks/FieldResearch/Icons/research

            hidden = @/locations.Count() < 3

            latitude = @/loc2.Latitude()
            longitude = @/loc2.Longitude()
            altitude = 0.0
        }
    }


// -----------------------------------------------------------------
//PARAMETERS FOR CONTRACT COMPLETION
// -----------------------------------------------------------------
//

    PARAMETER
    {
        name = CollectScience
        type = CollectScience

        subject = @/scienceSubjects
    }

// -----------------------------------------------------------------
// END OF CONTRACT
// -----------------------------------------------------------------
}
