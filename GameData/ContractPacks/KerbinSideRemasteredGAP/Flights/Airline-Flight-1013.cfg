//Airline-Flight-1013 - Trans Kerbin Airlines: Flight 1013 - Crew: 3 Passengers: 12-80

CONTRACT_TYPE
{

	sortKey = 1013

REQUIREMENTS FOR CONTRACT TO APPEAR

// requires MK3 passenger
	REQUIREMENT
	{
		name = PartUnlocked
		type = PartUnlocked

		part = mk3CrewCabin
	}

	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		
		contractType = Airline-Flight-1012
		minCount = 1

	}
	
	
//DATA NODES TO PROCESS FOR CONTRACT USE

//Contract Specific VesselParameterGroup Definition Key (to prevent conflict with other active contracts)
	DATA
	{
		type = string
		
		craft = KSRGAPcraftAirlineFlight1013
		
	}

//Passenger Data
	DATA
	{
		type = int
		
		numPassengers = Random(12, 80)
	
	}
	
	DATA
	{
		type = List<Kerbal>
		
		kerbals = NewKerbals(80).Random(@numPassengers)
		
		hidden = true
		
	}
	
//Snacks
	DATA
	{
		type = double
		
		numSnacks = Round(@numPassengers * 1.05)
		numAirSickness = Round(Random( 0 , @numPassengers / 6))
		
	}

//Flight Distance in Km 
       DATA
       {
              type = int
              fltDistance = 51     
       } 	

//CONTRACT DESCRIPTION

	name = Airline-Flight-1013
	title = Flight 1013 - Crew: 3 Passengers: @/numPassengers
	genericTitle = Flight 1013 - Crew: 3 Passengers: 12-80
	group = Trans Kerbin Airlines Prime
	agent = Trans Kerbin Airlines

	description = Trans Kerbin Airlines is proud to offer air transportation service to Kola Island Naval Air Station for KSC staff, Naval Service personel, and their families. While Kola Island is a military instalation, civilians are welcome to visit and enjoy the local beaches and resorts.&br;&br;Fly out @/numPassengers passengers to Kola Island, wait 30 seconds to disembark and embark passengers, take off and return back to KSC.
	
	genericDescription = Trans Kerbin Airlines is proud to offer air transportation service to Kola Island Naval Air Station for KSC staff, Naval Service personel, and their families. While Kola Island is a military instalation, civilians are welcome to visit and enjoy the local beaches and resorts.&br;&br;Fly out 12-80 passengers to Kola Island, wait 30 seconds to disembark and embark passengers, take off and return back to KSC.

	synopsis = This is a regular service round trip flight with no manual passenger exchange required. Trans Kerbin Airlines regular flight service contracts are paid on a per-passenger basis.

	notes = You may only use an airplane.

	completedMessage = Flight Completed!&br;&br;Snacks served: @/numSnacks&br;Air sickness bags used: @/numAirSickness&br;&br;Trans Kerbin Airlines thanks you for flying and reminds you the sky is no longer the limit.

//Contract Limits
   	maxCompletions = 0
   	maxSimultaneous = 1
//	weight = 30.0

	autoAccept = false
	declinable = true
	cancellable = true

	minExpiry = 7.0
	maxExpiry = 7.0
	deadline = 0

//Contract Reward Modifiers
	prestige = Trivial
   	targetBody = Kerbin

//Contract Rewards
  	advanceFunds = 4 * @fltDistance 
  	rewardFunds = ((15.0 * @fltDistance) + 7000 ) * Random(1.0, 1.05)
  	rewardReputation = 1.0
 	rewardScience = 1.0

//Contract Penalties
  	failureFunds = ((4 * @fltDistance) + (@/numPassengers * 10)) * Random(1.0, 1.25) 
 	failureReputation = 20


//BEHAVIOURS TO DO WHEN CREATING CONTRACT

	BEHAVIOUR
	{
		name = SpawnPassengers
		type = SpawnPassengers
		
		kerbal = @/kerbals
		
		kerbalType = Tourist
		
	}

	BEHAVIOUR
	{
        name = WaypointGenerator
        type = WaypointGenerator
		
        WAYPOINT
		{
			name = Kola Island Naval Air Station
			icon = ContractPacks/KerbinSideRemasteredGAP/Assets/Icons/Airport
                         
            targetBody = Kerbin
			latitude = -4.15968561172485
			longitude = -72.1093521118164
			altitude = 0.0
		}
		
		PQS_CITY
		{
			name = KSC Air Terminal
			icon = ContractPacks/KerbinSideRemasteredGAP/Assets/Icons/Airport
			
			pqsCity = KSC
			pqsOffset = -397.673310011714, 367.567136523425, 25.0483683246694
			altitude = 20
			parameter = RequestLandingLaunch
			
		}
		
		PQS_CITY
		{
			name = KSC Runway
			icon = ContractPacks/KerbinSideRemasteredGAP/Assets/Icons/Airport
			
			pqsCity = KSC
			pqsOffset = -1302.43054364842, 496.887726562927, 28.40858532858
			altitude = 20
			
		}
	
	}
	
	BEHAVIOUR
	{
		name = DialogBox
		type = DialogBox
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestTakeoffLaunch
			
			position = CENTER
			
			TEXT
			{
				text = KSC ATC: Trans One Zero One Three, you are cleared to for depature to Kola Island, heading one seven three, squawk one six six seven.

			}
			
			IMAGE
			{
				url = ContractConfigurator/ui/eva_ac_female
				characterName = Air Traffic Control
			}
			
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestLandingSite1
			
			position = CENTER
			
			TEXT
			{
				text = Kola Island ATC: Trans One Zero One Three, we have you on approach. You are cleared to land at Kola Island. Winds three four niner at one four.

			}
			
			IMAGE
			{
				url = ContractConfigurator/ui/eva_ac_male
				characterName = Air Traffic Control
			}
			
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestTakeoffSite1
			
			position = CENTER
			
			TEXT
			{
				text = Kola Island ATC: Trans One Zero One Three, you are cleared for departure to Kerbin Space Center airport. Depart Kola Island on heading three five three, squawk one six six seven.

			}
			
			IMAGE
			{
				url = ContractConfigurator/ui/eva_ac_male
				characterName = Air Traffic Control
			}
			
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestLandingLaunch
			
			position = CENTER
			
			TEXT
			{
				text = KSC ATC: Trans One Zero One Three, we have you on approach. You are cleared to land. Winds zero five five at zero niner.

			}
			
			IMAGE
			{
				url = ContractConfigurator/ui/eva_ac_male
				characterName = Air Traffic Control
			}
			
		}
		
	}
	

	
//PARAMETERS FOR CONTRACT COMPLETION

//Craft definition
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = Your aircraft must
		
		define = @/craft
		dissassociateVesselsOnContractCompletion = true

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have two certified pilots
			
			trait = Pilot
			minCrew = 2
			
			disableOnStateChange = false
			hideChildren = true

		}
		
			PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a certified engineer
			
			trait = Engineer
			minCrew = 1
			
			disableOnStateChange = false
			hideChildren = true

		}	
		
		PARAMETER
		{
			name = PartValidation
			type = PartValidation
			title = have wings
			
			category = Aero
			
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = HasCrewCapacity
			type = HasCrewCapacity
			title = have at least @/numPassengers passenger seats
			
			minCapacity = @/numPassengers + 3
			
			disableOnStateChange = false
			
		}
		
	//Passenger Manifest - Load Passengers
		PARAMETER
		{
			name = All
			type = All
			
			title = load all @/numPassengers passengers
			
			PARAMETER
			{
				name = HasPassengers
				type = HasPassengers
				title = @kerbal.First()
		
				ITERATOR
				{
					type = Kerbal
					kerbal = @/kerbals
					
				}
				
				hideChildren = true
				hidden = true
				
			}
			
			disableOnStateChange = false

		}
		
		disableOnStateChange = false

	}

//Launch Site
	PARAMETER
	{
		name = LaunchSite
		type = VesselParameterGroup
		title = start from KSC
		
		vessel = @/craft
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 2

			distance = 500
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true	
	}
	
//Contract Goals
	PARAMETER
	{
		name = RequestTakeoffLaunch
		type = Duration
		
		duration = 5s
		preWaitText = request clearance for takeoff:
		waitingText = requesting clearance for takeoff: 
		completionText = be cleared for takeoff

		completeInSequence = true
		disableOnStateChange = true
		
	}

//Clear for Landing Site1
	PARAMETER
	{
		name = RequestLandingSite1
		type = VesselParameterGroup
		title = request clearance for landing
		
		vessel = @/craft
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 19000
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true
		hidden = true
	
	}


//Navigate to waypoint requirement include landing to a complete stop
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = land at Kola Island
		
		vessel = @/craft
		
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = LANDED
			maxSpeed = 0.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 690
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true	
	
	}
	
//Wait for Passenger Exchange
	PARAMETER
	{
		name = PassengerExchange
		type = All
		title = and wait for passenger exchange
		
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = LANDED
			maxSpeed = 0.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 690
			hideOnCompletion = true
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}
		
		PARAMETER
		{
			name = Duration
			type = Duration
			
			duration = 30s
			preWaitText = wait to exchange passengers for:
			waitingText = exchanging passengers now: 
			completionText = all passengers exchanged!

			completeInSequence = true
			disableOnStateChange = true			
			
		}
		
		completeInSequence = true
		disableOnStateChange = true
		
	}
	
	PARAMETER
	{
		name = RequestTakeoffSite1
		type = Duration
		
		duration = 5s
		preWaitText = request clearance for takeoff
		waitingText = requesting clearance for takeoff
		completionText = be cleared for takeoff

		completeInSequence = true
		disableOnStateChange = true
		
	}
	
//Clear for Landing Launch
	PARAMETER
	{
		name = RequestLandingLaunch
		type = VesselParameterGroup
		title = request clearance for landing
		
		vessel = @/craft
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 1

			distance = 19000
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true
		hidden = true
	
	}


//Recovery Parameter - Landing
	PARAMETER
	{
		name = Any
		type = Any
		title = and then land and stop
		
		PARAMETER
		{
			name = Any
			type = Any
			title = at one of the following recovery areas

			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the KSC Runway
				
				vessel = @/craft

				PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = Runway
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				disableOnStateChange = false
				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = or the KSC Air Terminal
				
				vessel = @/craft

				PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = SPH
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}
				
				disableOnStateChange = false
				hideChildren = true		

			}
		
			disableOnStateChange = false
		
		}
		
		completeInSequence = true
		disableOnStateChange = false

	}

//Recovery Parameter - Craft & Kerbal Safety Check
	PARAMETER
	{
		name = All
		type = All
		title = safely
		
		PARAMETER
		{
			name = VesselNotDestroyed
			type = VesselNotDestroyed
			title = without destroying your aircraft
			
			vessel = @/craft

		}
		
		PARAMETER
		{
			name = KerbalDeaths
			type = KerbalDeaths
			title = or killing anyone
			
			vessel = @/craft

		}
		
//
// Bug #198 (KSP 1.1.3 has EVA kerbals experiencing 15+ Gs on exit)
//		
//		PARAMETER
//		{
//			name = VesselParameterGroup
//			type = VesselParameterGroup
//			title = or exceeding 9 Gs at any time during the flight
//			
//			vessel = @/craft
//			
//			PARAMETER
//			{
//				name = ReachState
//				type = ReachState
//				
//				maxAcceleration = 9.0
//				failWhenUnmet = true
//				
//				disableOnStateChange = false
//				hideChildren = true
//				hidden = true
//			
//			}
//			
//			disableOnStateChange = false
//			hideChildren = true
//		
//		}
		
		completeInSequence = true
		disableOnStateChange = true
		
	}

//Recovery Parameter - Recover Kerbals
	PARAMETER
	{
		name = All
		type = All
		title = and recover all @/numPassengers passengers
		
		PARAMETER
		{
			name = RecoverKerbal
			type = RecoverKerbal
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbals
				
			}
			
			hideChildren = true
			hidden = true
			
		}
		
	}
	
}