//Airline-Flight1063B - Trans Kerbin Airlines: Flight 1063B - Crew: 3 Passengers: 12-80

CONTRACT_TYPE
{

	sortKey = 1063b

REQUIREMENTS FOR CONTRACT TO APPEAR

// requires MK3 passenger
	REQUIREMENT
	{
		name = PartUnlocked
		type = PartUnlocked
  
									 
			  

		part = mk3CrewCabin
	}
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		
		contractType = Airline-Flight-1062B
		minCount = 1

	}
	
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		
		contractType = Airline-Flight-1040
		minCount = 1

	}
	
	
//DATA NODES TO PROCESS FOR CONTRACT USE
//Contract Specific VesselParameterGroup Definition Key (to prevent conflict with other active contracts)
	DATA
	{
		type = string
		
		craft = KSRGAPcraftAirlineFlight1063B
		
	}

//Passenger Data
	DATA
	{
		type = int
		
		numPassengers = Random(12, 80)
	
	}
	
//Snacks
	DATA
	{
		type = double
		
		numSnacks = Round(@numPassengers * 1.05)
		numAirSickness = Round(Random( 0 , @numPassengers / 6))
		
	}

//Flight Distance in Km 
   DATA
   {
		  type = int
		  fltDistance = 522 + 813
   } 	

//List of Possible ATC characters
	DATA
	{
		type = List<string>
		
		ATCtypes = ["ATC_M" ,"ATC_F"]
		
		hidden = true 
	}
	
//List of Possible NAS ATC characters
											   
	DATA
	{
		type = List<string>
		
		NASATCtypes = ["NAS_ATC_M" ,"NAS_ATC_F"]
		
		hidden = true 
  
	}
	
//Pick Random ATC character to Use for KSC Site
	DATA
	{
		type = string
		
		KSC_ATC = @/ATCtypes.Random()
		
		hidden = true
		
	}
	
//Pick One Random ATC character to Use for Site1
	DATA
	{
		type = string
		
		SITE1_ATC = @/NASATCtypes.Random()
		
		hidden = true
		
	}
	
//Pick One Random ATC character to Use for Site2
	DATA
	{
		type = string
		
		SITE2_ATC = @/NASATCtypes.Random()
		
		hidden = true
		
	}
	
//CONTRACT DESCRIPTION

	name = Airline-Flight-1063B
	title = Flight 1063B - Crew: 3 Passengers: @/numPassengers
	genericTitle = Flight 1063B - Crew: 3 Passengers: 12-80
	group = Trans Kerbin Airlines Prime
	agent = Trans Kerbin Airlines

	description = Trans Kerbin Airlines is proud to offer air transportation service to Meeda Naval Air Station for KSC staff, Naval Service personel, and their families, with a connecting flight to Sandy Island Naval Air Station. While Meeda is a military instalation, civilians are welcome to visit and make connecting flights to other locations in Serthenia.&br;&br;Fly out @/numPassengers passsengers to Meeda, exchange pasengers and continue to Sandy Island. Then return to KSC.
	
	genericDescription = Trans Kerbin Airlines is proud to offer air transportation service to Meeda Naval Air Station for KSC staff, Naval Service personel, and their families, with a connecting flight to Sandy Island Naval Air Station. While Meeda is a military instalation, civilians are welcome to visit and make connecting flights to other locations in Serthenia.&br;&br;Fly out 12-80 passengers to Meeda, exchange pasengers and continue to Sandy Island. Then return to KSC.

	synopsis = This is a regular service flight with a connecting flight to a second site with no manual passenger exchange required. Trans Kerbin Airlines regular flight service contracts are paid on a per-passenger basis.

	notes = You may only use an airplane.

	completedMessage = Flight Completed!&br;&br;Snacks served: @/numSnacks&br;Air sickness bags used: @/numAirSickness&br;&br;Trans Kerbin Airlines thanks you for flying and reminds you the sky is no longer the limit.

//Contract Limits
   	maxCompletions = 0
   	maxSimultaneous = 1

	autoAccept = false
	declinable = true
	cancellable = true

	minExpiry = 7.0
	maxExpiry = 7.0
	deadline = 0

//Contract Reward Modifiers
	prestige = Significant
   	targetBody = Kerbin

//Contract Rewards
	rewardFunds = ((30000 + @fltDistance + (200 * @/numPassengers )) * Random(1.0, 1.15)) * 2 
	advanceFunds = (@/rewardFunds * 0.25 )
	rewardReputation = 2.0
    rewardScience = 1.0

//Contract Penalties
	failureFunds =  (@/rewardFunds * 1.15) * Random(1.0, 1.25)  
	failureReputation = 10 + ( @/numPassengers) 


//BEHAVIOURS TO DO WHEN CREATING CONTRACT

	BEHAVIOUR
	{
        name = SpawnPassengers
        type = SpawnPassengers
        count = @/numPassengers
		kerbalType = Tourist
		removePassengers = true
	}

// Eliminate craft on contract failure to prevent tourist spam in Astronaut Complex	
	BEHAVIOUR
	{
		name = DestroyVessel
		type = DestroyVessel
		onState = CONTRACT_FAILED
		vessel = @/craft
	}

	BEHAVIOUR
	{
        name = WaypointGenerator
        type = WaypointGenerator
		
        WAYPOINT
		{
			name = Meeda Naval Air Station
			icon = ContractPacks/KerbinSideRemasteredGAP/Assets/Icons/Airport
                         
            targetBody = Kerbin
			latitude = 37.86918259
			longitude = -109.843895
			altitude = 0.0
		}
		
		PQS_CITY
		{
			name = KSC Air Terminal
			icon = ContractPacks/KerbinSideRemasteredGAP/Assets/Icons/Airport
			
			pqsCity = KSC
			pqsOffset = -397.673310011714, 367.567136523425, 25.0483683246694
			altitude = 20
			parameter = RequestLandingLaunch
			
		}
		
		PQS_CITY
		{
			name = KSC Runway
			icon = ContractPacks/KerbinSideRemasteredGAP/Assets/Icons/Airport
			
			pqsCity = KSC
			pqsOffset = -1302.43054364842, 496.887726562927, 28.40858532858
			altitude = 20
			
		}
		
        WAYPOINT
		{
			name = Sandy Island Naval Air Station
			icon = ContractPacks/KerbinSideRemasteredGAP/Assets/Icons/Airport
                         
            targetBody = Kerbin
			latitude = -8.151759148
			longitude = -42.39810181
			altitude = 0.0
		}
	
	}
	
	BEHAVIOUR
	{
		name = DialogBox
		type = DialogBox
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestTakeoffLaunch
			
			position = CENTER
			
			TEXT
			{
				text = KSC ATC: Trans One Zero Six Three Bravo, you are cleared to for depature to Meeda, heading three two three, squawk six five six four.
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
			    url = ContractPacks/KerbinSideRemasteredGAP/Assets/Characters/@/KSC_ATC
				characterName = Air Traffic Control
			}
			
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestLandingSite1
			
			position = CENTER
			
			TEXT
			{
				text = Meeda ATC: Trans One Zero Six Three Bravo, we have you on approach. You are cleared to land at Meeda. Winds two eight niner at zero seven.
				fontSize = 20
				textColor = #BADA55

			}
			
			IMAGE
			{
                url = ContractPacks/KerbinSideRemasteredGAP/Assets/Characters/@/SITE1_ATC
				characterName = Air Traffic Control
			}
			
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestTakeoffSite1
			
			position = CENTER
			
			TEXT
			{
				text = Meeda ATC: Trans One Zero Six Three Bravo, you are cleared for departure to Sandy Island Naval Air Station, heading one one three, squawk three six five three.
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
                url = ContractPacks/KerbinSideRemasteredGAP/Assets/Characters/@/SITE1_ATC
				characterName = Air Traffic Control
			}
			
		}
		
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestLandingSite2
			
			position = CENTER
			
			TEXT
			{
				text = Sandy Island ATC: Trans One Zero Six Three Bravo, we have you on approach. You are cleared to land at Sandy Island Naval Air Station. Winds one seven zero at zero five.
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
                url = ContractPacks/KerbinSideRemasteredGAP/Assets/Characters/@/SITE2_ATC
				characterName = Air Traffic Control
			}
			
		}
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestTakeoffSite2
			
			position = CENTER
			
			TEXT
			{
				text = Sandy Island ATC: Trans One Zero Six Three Bravo, you are cleared for departure to Kerbin Space Center airport, heading three two seven, squawk three six five three.
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
                url = ContractPacks/KerbinSideRemasteredGAP/Assets/Characters/@/SITE2_ATC
				characterName = Air Traffic Control
			}
			
		}
		
		
		DIALOG_BOX
		{
			condition = PARAMETER_COMPLETED
			parameter = RequestLandingLaunch
			
			position = CENTER
			
			TEXT
			{
				text = KSC ATC: Trans One Zero Six Three Bravo, we have you on approach. You are cleared to land. Winds two five eight at one one.
				fontSize = 20
				textColor = #BADA55
			}
			
			IMAGE
			{
			    url = ContractPacks/KerbinSideRemasteredGAP/Assets/Characters/@/KSC_ATC
				characterName = Air Traffic Control
			}
			
		}
		
		DIALOG_BOX
		{
			condition = CONTRACT_FAILED
			
			position = CENTER
			title = <b>Sometimes Things Go Wrong</b>
			titleColor = #FF0000
			
			TEXT
			{
				text = KSC ATC: Trans One Zero Six Three Bravo, Are you there? please respond. Trans One Zero Six Three Bravo, we've lost you on radar, do you copy? Are you declaring an emergency?.... and you were doing so well.
				fontSize = 20
				textColor = #FF0000				
			}
			
			IMAGE
			{
				url = ContractPacks/KerbinSideRemasteredGAP/Assets/Characters/@/KSC_ATC
				characterName = NAS ATC
			}
			
		}		
		
	}

	
//PARAMETERS FOR CONTRACT COMPLETION

//Craft definition
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = Your aircraft must
		
		define = @/craft
		// Do not dissassociate on failure this prevents vessel destruction behaviour
		dissassociateVesselsOnContractFailure = false

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have two certified pilots
			
			trait = Pilot
			minCrew = 2
			
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a certified engineer
			
			trait = Engineer
			minCrew = 1
			
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = PartValidation
			type = PartValidation
			title = have wings
			
			category = Aero
			
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = HasCrewCapacity
			type = HasCrewCapacity
			title = have at least @/numPassengers passenger seats
			
			minCapacity = @/numPassengers + 3
			
			disableOnStateChange = false
			
		}
		
	//Passenger Manifest - Load Passengers

			
		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = load all @/numPassengers passengers
			count = @/numPassengers
			hideChildren = true
			
		}
		
		disableOnStateChange = false

	}

//Launch Site
	PARAMETER
	{
		name = LaunchSite
		type = VesselParameterGroup
		title = start from KSC
		
		vessel = @/craft
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 2

			distance = 500
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true	
	}
	
//Contract Goals
	PARAMETER
	{
		name = RequestTakeoffLaunch
		type = Duration
		
		duration = 5s
		preWaitText = request clearance for takeoff:
		waitingText = requesting clearance for takeoff: 
		completionText = be cleared for takeoff

		completeInSequence = true
		disableOnStateChange = true
		
	}

//Clear for Landing Site1
	PARAMETER
	{
		name = RequestLandingSite1
		type = VesselParameterGroup
		title = request clearance for landing
		
		vessel = @/craft
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 19000
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true
		hidden = true
	
	}	

//Navigate to waypoint requirement include landing to a complete stop
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = land at Meeda
		
		vessel = @/craft
		
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = LANDED
			maxSpeed = 0.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 690
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true	
	
	}
	
//Wait for Passenger Exchange
	PARAMETER
	{
		name = PassengerExchange
		type = All
		title = and wait for passenger exchange
		
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = LANDED
			maxSpeed = 0.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 690
			hideOnCompletion = true
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}
		
		PARAMETER
		{
			name = Duration
			type = Duration
			
			duration = 30s
			preWaitText = wait to exchange passengers for:
			waitingText = exchanging passengers now: 
			completionText = all passengers exchanged!

			completeInSequence = true
			disableOnStateChange = true			
			
		}
		
		completeInSequence = true
		disableOnStateChange = true
		
	}
	
	PARAMETER
	{
		name = RequestTakeoffSite1
		type = Duration
		
		duration = 5s
		preWaitText = request clearance for takeoff
		waitingText = requesting clearance for takeoff
		completionText = be cleared for takeoff

		completeInSequence = true
		disableOnStateChange = true
		
	}
	
//Clear for Landing Site2
	PARAMETER
	{
		name = RequestLandingSite2
		type = VesselParameterGroup
		title = request clearance for landing
		
		vessel = @/craft
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 3

			distance = 19000
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true
		hidden = true
	
	}

//Navigate to waypoint requirement include landing to a complete stop
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = land at Sandy Island
		
		vessel = @/craft
		
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = LANDED
			maxSpeed = 0.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 3

			distance = 690
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true	
	
	}
	
//Wait for Passenger Exchange
	PARAMETER
	{
		name = PassengerExchange
		type = All
		title = and wait for passenger exchange
		
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = LANDED
			maxSpeed = 0.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 3

			distance = 690
			hideOnCompletion = true
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}
		
		PARAMETER
		{
			name = Duration
			type = Duration
			
			duration = 30s
			preWaitText = wait to exchange passengers for:
			waitingText = exchanging passengers now: 
			completionText = all passengers exchanged!

			completeInSequence = true
			disableOnStateChange = true			
			
		}
		
		completeInSequence = true
		disableOnStateChange = true
		
	}
	
	PARAMETER
	{
		name = RequestTakeoffSite2
		type = Duration
		
		duration = 5s
		preWaitText = request clearance for takeoff
		waitingText = requesting clearance for takeoff
		completionText = be cleared for takeoff

		completeInSequence = true
		disableOnStateChange = true
		
	}
	
//Clear for Landing Launch
	PARAMETER
	{
		name = RequestLandingLaunch
		type = VesselParameterGroup
		title = request clearance for landing
		
		vessel = @/craft
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 1

			distance = 19000
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true
		hidden = true
	
	}


//Recovery Parameter - Landing
	PARAMETER
	{
		name = Any
		type = Any
		title = and then land and stop
		
		PARAMETER
		{
			name = Any
			type = Any
			title = at one of the following recovery areas

			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the KSC Runway
				
				vessel = @/craft

			PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = Runway
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				disableOnStateChange = false
				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = or the KSC Air Terminal
				
				vessel = @/craft

				PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = SPH
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true
				}
				disableOnStateChange = false
				hideChildren = true		

			}
		
			disableOnStateChange = false
		
		}
		
		completeInSequence = true
		disableOnStateChange = false

	}

//Recovery Parameter - Craft & Kerbal Safety Check
	PARAMETER
	{
		name = All
		type = All
		title = safely...
		
		PARAMETER
		{
			name = VesselNotDestroyed
			type = VesselNotDestroyed
			title = without destroying your aircraft
		
			vessel = @/craft

		}
		
		PARAMETER
		{
			name = KerbalDeaths
			type = KerbalDeaths
			title = or killing anyone
			
			vessel = @/craft

		}
		
		completeInSequence = true
		disableOnStateChange = true
		
	}

//Recovery Parameter - Recover Kerbals
	PARAMETER
	{
        name = RecoverKerbal
        type = RecoverKerbal
		title = and recover all @/numPassengers passengers
        completeInSequence = true
    }
	
}